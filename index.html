<!doctype html><html lang="es"><meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1"><title>Directorio JxBE</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#fff;--text:#111;--muted:#555;--card:#fff;--border:#e2e2e2;
  --brand:#2469AA;--accent:#111;--radius:12px
}
*{box-sizing:border-box}
body{font-family:Montserrat,system-ui,Arial;background:var(--bg);color:var(--text);margin:0;padding:24px}
#q{width:100%;max-width:780px;padding:12px 14px;border:1px solid var(--border);border-radius:10px}
.header{display:flex;align-items:center;gap:12px;flex-wrap:wrap;margin-bottom:16px}
.brand{font-weight:600;color:var(--brand)}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:28px}
.card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:24px;text-align:center}
.avatar-wrap{width:220px;height:220px;margin:0 auto 18px;overflow:hidden;border-radius:50%;border:1px solid var(--border)}
.avatar{width:100%;height:100%;object-fit:cover;background:#f4f4f4}

/* placeholder cuadrado */
.ph-wrap{width:120px;height:120px;margin:0 auto 18px;border:1px solid var(--border);
  border-radius:8px;overflow:hidden;background:#fff}
.avatar--ph{width:100%;height:100%;object-fit:contain;padding:10px;background:#fff}

.cargo{font-weight:700;letter-spacing:.6px;font-size:14px;margin:6px 0 2px;text-transform:uppercase}
.name{font-weight:600;font-size:18px;margin:0 0 14px}
.grado{font-weight:700;font-size:14px;text-transform:uppercase;margin:6px 0}
.meta{font-size:14px;color:var(--muted);line-height:1.5;margin:4px 0}
.intereses{font-size:14px;color:var(--muted);line-height:1.5;margin:12px 0 0}
.btn{display:inline-block;margin-top:18px;padding:10px 16px;border-radius:8px;
  border:1.5px solid var(--accent);color:var(--accent);background:transparent;
  text-decoration:none;font-weight:600}
.btn:hover{filter:brightness(.9)}
</style>

<div class="header">
  <input id="q" type="search" placeholder="Buscar por nombre, formación, afiliación, intereses">
  <div class="brand">JxBE · Directorio</div>
</div>
<div id="grid" class="grid"></div>

<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2"></script>
<script>
const GITHUB_BASE = "https://raw.githubusercontent.com/jovenesbotanicos/directorio-socios/main/fotos/";
const DATA_URL    = "https://raw.githubusercontent.com/jovenesbotanicos/directorio-socios/main/data/data.json";
const PLACEHOLDER = "https://raw.githubusercontent.com/jovenesbotanicos/directorio-socios/main/logo.png";

const elQ = document.getElementById('q');
const elGrid = document.getElementById('grid');
const SHOW_ROWS=5, PER_ROW=5, DEFAULT_COUNT=SHOW_ROWS*PER_ROW;

let allRows=[], fuse;
const esc=s=>String(s||'').replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));

function gitFoto(u){
  const m = u && String(u).match(/(?:id=|\/d\/)([A-Za-z0-9_-]{10,})/);
  return m ? `${GITHUB_BASE}${m[1]}.jpg` : PLACEHOLDER;
}

const shuffle=a=>{for(let i=a.length-1;i>0;i--){const j=Math.random()*(i+1)|0;[a[i],a[j]]=[a[j],a[i]];}return a;};

function render(list){
  elGrid.innerHTML = list.map(r=>{
    const src = gitFoto(r.foto);
    const isPh = src === PLACEHOLDER;
    const avatar = isPh
      ? `<div class="ph-wrap"><img class="avatar--ph" src="${esc(src)}" alt=""></div>`
      : `<div class="avatar-wrap"><img class="avatar" src="${esc(src)}" alt=""></div>`;
    const cargo = r.cargo ? `<div class="cargo">${esc(r.cargo)}</div>` : '';
    const grado = r.formacion ? `<div class="grado">${esc(r.formacion)}</div>` : '';
    const afil  = r.afiliacion ? `<div class="meta">${esc(r.afiliacion)}</div>` : '';
    const inter = r.intereses ? `<div class="intereses">${esc(r.intereses)}</div>` : '';
    const btn   = r.enlace ? `<a class="btn" href="${esc(r.enlace)}" target="_blank" rel="noopener">Más información</a>` : '';
    return `
    <div class="card">
      ${avatar}
      ${cargo}
      <div class="name">${esc(r.nombre||'')}</div>
      ${grado}
      ${afil}
      ${inter}
      ${btn}
    </div>`;
  }).join('');
}

function handleData(arr){
  allRows=(arr||[]).filter(r=>r && r.nombre);
  fuse=new Fuse(allRows,{keys:["nombre","formacion","afiliacion","intereses","cargo"],threshold:0.33});
  render(shuffle([...allRows]).slice(0, DEFAULT_COUNT));
}

// carga datos (cache-busting)
fetch(`${DATA_URL}?t=${Date.now()}`)
  .then(r=>r.json())
  .then(handleData)
  .catch(()=>{ elGrid.textContent="Error cargando datos."; });

elQ.addEventListener('input', e=>{
  const v=e.target.value.trim();
  render(v ? fuse.search(v).map(x=>x.item) : shuffle([...allRows]).slice(0, DEFAULT_COUNT));
});
</script>
